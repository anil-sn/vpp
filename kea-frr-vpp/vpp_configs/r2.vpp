#
# VPP Configuration for the 'r2' node
# Role: Connects downstream to 'bng' and 'r1'.
#

# --- Link to bng (memif-c) ---
# Define the socket file for the link to 'bng'.
create memif socket id 0 /sockets/memif-c.sock

# Create a memif interface in SLAVE mode, connecting to the master 'bng' node.
create interface memif id 0 socket-id 0 slave

# Create the corresponding tap interface for the Linux kernel (FRR).
create tap id 0 host-if-name tap-r2-bng

# Bridge the memif and tap interfaces together at L2.
set interface l2 bridge memif0 0
set interface l2 bridge tap0 0

# Bring the interfaces up.
set interface state memif0 up
set interface state tap0 up


# --- Link to r1 (memif-b) ---
# Define the socket file for the link to 'r1'.
create memif socket id 1 /sockets/memif-b.sock

# Create a memif interface in SLAVE mode, connecting to the master 'r1' node.
create interface memif id 1 socket-id 1 slave

# Create the second tap interface.
create tap id 1 host-if-name tap-r2-r1

# Bridge the second pair of interfaces.
set interface l2 bridge memif1 1
set interface l2 bridge tap1 1

# Bring the interfaces up.
set interface state memif1 up
set interface state tap1 up