{
  "default_mode": "aws_gke_production",
  "modes": {
    "aws_gke_production": {
      "deployment": {
        "source": "aws_traffic_mirroring",
        "destination": "gke_processing_service", 
        "preserve_source_ip": true,
        "handle_layer2_forwarding": true
      },
      "networks": [
        {
          "name": "aws-mirror-ingress",
          "subnet": "10.10.0.0/24",
          "gateway": "10.10.0.1",
          "description": "AWS Traffic Mirroring VXLAN ingress",
          "mtu": 9000,
          "aws_integration": {
            "traffic_mirror_target": true,
            "eni_mac_handling": true
          }
        },
        {
          "name": "vxlan-decap-processing",
          "subnet": "10.11.0.0/24", 
          "gateway": "10.11.0.1",
          "description": "VXLAN decapsulation and MAC rewrite processing",
          "mtu": 9000
        },
        {
          "name": "source-ip-nat-processing",
          "subnet": "10.12.0.0/24",
          "gateway": "10.12.0.1", 
          "description": "Source IP preservation and NAT processing"
        },
        {
          "name": "gke-forwarding",
          "subnet": "10.13.0.0/24",
          "gateway": "10.13.0.1",
          "description": "GKE service forwarding network"
        }
      ],
      "containers": {
        "aws-target-ec2-processor": {
          "description": "AWS Mirror Target EC2 with dual ENI processing (matches diagram 2.png)",
          "dockerfile": "src/containers/Dockerfile.aws-target-ec2", 
          "config_script": "src/containers/aws-target-ec2-config.sh",
          "interfaces": [
            {
              "name": "eth0",
              "network": "aws-mirror-ingress", 
              "ip": {
                "address": "10.0.0.10",
                "mask": 24
              },
              "description": "Primary ENI - VXLAN ingress from Traffic Mirror",
              "aws_eni_mac": "aa:bb:cc:00:00:02",
              "aws_eni_type": "primary"
            },
            {
              "name": "eth1",
              "network": "vxlan-decap-processing",
              "ip": {
                "address": "10.0.0.20",
                "mask": 24
              },
              "description": "Secondary ENI - processed traffic to br0 bridge", 
              "aws_eni_mac": "de:ad:be:ef:56:78",
              "aws_eni_type": "secondary"
            }
          ],
          "vxlan_tunnel": {
            "src": "10.0.0.10",
            "dst": "auto_detect",
            "vni": "auto_detect",
            "port": 4789,
            "decap_next": "l3_dnat_bridge",
            "aws_traffic_mirror": true
          },
          "bridge_setup": {
            "name": "br0",
            "mac": "de:ad:be:ef:56:78",
            "ip": "10.0.0.20",
            "description": "Bridge matching diagram br0 setup"
          },
          "dnat_processing": {
            "enabled": true,
            "original_dst_port": 31756,
            "target_dst_port": 8081,
            "preserve_source_ip": true,
            "description": "DNAT processing as shown in diagram"
          }
        },
        "source-ip-processor": {
          "description": "Source IP preservation and forwarding processor",
          "dockerfile": "src/containers/Dockerfile.source-ip-processor",
          "config_script": "src/containers/source-ip-processor-config.sh",
          "interfaces": [
            {
              "name": "eth0", 
              "network": "vxlan-decap-processing",
              "ip": {
                "address": "10.11.0.20",
                "mask": 24
              }
            },
            {
              "name": "eth1",
              "network": "source-ip-nat-processing", 
              "ip": {
                "address": "10.12.0.10",
                "mask": 24
              }
            }
          ],
          "source_ip_preservation": {
            "method": "src_nat_bypass",
            "preserve_fields": ["src_ip", "dst_ip", "src_port", "dst_port"],
            "tunnel_original": false,
            "rewrite_only_macs": true
          },
          "nat44": {
            "sessions": 50000,
            "mode": "source_ip_passthrough",
            "inside_interface": "eth0",
            "outside_interface": "eth1",
            "bypass_nat_for_preserved_flows": true
          }
        },
        "fdi-gcp-forwarder": {
          "description": "FDI GCP service forwarder (matches diagram 1.png)", 
          "dockerfile": "src/containers/Dockerfile.fdi-gcp-forwarder",
          "config_script": "src/containers/fdi-gcp-forwarder-config.sh",
          "interfaces": [
            {
              "name": "eth0",
              "network": "source-ip-nat-processing",
              "ip": {
                "address": "10.12.0.20",
                "mask": 24
              }
            },
            {
              "name": "eth1", 
              "network": "gke-forwarding",
              "ip": {
                "address": "10.13.0.10",
                "mask": 24
              }
            }
          ],
          "fdi_gcp_integration": {
            "service_endpoint": "fdi-ingress-nlb.gcp.example.com",
            "service_port": 8081,
            "destination_ip": "100.76.10.11",
            "load_balancer_type": "fdi_nlb",
            "preserve_source_ip": true,
            "protocol": "UDP",
            "description": "FDI GKE service as shown in diagram 1.png"
          },
          "tap_interface": {
            "id": 0,
            "name": "gke-tap0", 
            "ip": "10.200.0.1/24",
            "linux_ip": "10.200.0.2/24",
            "pcap_file": "/var/log/vpp/aws-gke-traffic.pcap",
            "rx_mode": "interrupt"
          }
        }
      },
      "traffic_config": {
        "aws_traffic_mirror": {
          "vxlan_port": 4789,
          "expected_vni": ["100", "200", "auto"],
          "source_types": ["netflow", "sflow", "ipfix"],
          "mirror_target_ec2": true,
          "df_bit_handling": {
            "enabled": true,
            "vxlan_mtu": 1450,
            "inner_mtu": 1400,
            "udp_fragmentation": "clear_df_bit",
            "reassembly_timeout": 10000,
            "max_reassemblies": 2048,
            "protocols": ["udp_netflow", "udp_sflow", "udp_ipfix"]
          }
        },
        "gke_destination": {
          "service_name": "netflow-processor",
          "namespace": "default", 
          "port": 2055,
          "protocol": "UDP",
          "load_balancer_ip": "auto_detect"
        },
        "performance": {
          "packet_count": 10000,
          "packet_size": 1500,
          "test_duration": 300,
          "concurrent_flows": 1000,
          "production_mode": true
        }
      },
      "aws_specific": {
        "region": "us-east-1",
        "vpc_id": "auto_detect",
        "mirror_target_type": "network-interface",
        "eni_security_groups": ["sg-vpp-mirror-target"],
        "instance_type": "c5n.xlarge",
        "placement": {
          "availability_zone": "us-east-1a",
          "tenancy": "default"
        }
      },
      "gke_specific": {
        "cluster_name": "netflow-processing-cluster",
        "region": "us-central1",
        "service_account": "vpp-forwarder@project.iam.gserviceaccount.com",
        "network_policy": "allow-vpp-ingress"
      },
      "production_settings": {
        "high_performance": true,
        "numa_optimization": true,
        "cpu_isolation": ["2-11"],
        "huge_pages": "8GB",
        "buffer_size": 65536, 
        "worker_threads": 8,
        "rx_queues": 8,
        "tx_queues": 8,
        "aws_enhanced_networking": true,
        "sr_iov": true
      }
    }
  }
}