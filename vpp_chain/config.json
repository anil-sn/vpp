{
  "default_mode": "gcp",
  "modes": {
    "gcp": {
      "networks": [
        {
          "name": "external-ingress",
          "subnet": "172.20.0.0/24",
          "gateway": "172.20.0.1"
        },
        {
          "name": "ingress-vxlan",
          "subnet": "172.20.1.0/24",
          "gateway": "172.20.1.1"
        },
        {
          "name": "vxlan-nat",
          "subnet": "172.20.2.0/24",
          "gateway": "172.20.2.1"
        },
        {
          "name": "nat-ipsec",
          "subnet": "172.20.3.0/24",
          "gateway": "172.20.3.1"
        },
        {
          "name": "ipsec-fragment",
          "subnet": "172.20.4.0/24",
          "gateway": "172.20.4.1"
        },
        {
          "name": "fragment-gcp",
          "subnet": "172.20.5.0/24",
          "gateway": "172.20.5.1"
        }
      ],
      "containers": {
        "chain-ingress": {
          "description": "VXLAN packet reception",
          "dockerfile": "src/containers/ingress/Dockerfile.ingress",
          "config_script": "ingress-config.sh",
          "interfaces": [
            {
              "name": "eth0",
              "network": "external-ingress",
              "ip": {
                "address": "172.20.0.10",
                "mask": 24
              }
            },
            {
              "name": "eth1",
              "network": "ingress-vxlan",
              "ip": {
                "address": "172.20.1.10",
                "mask": 24
              }
            }
          ],
          "bridge_domain_id": 1,
          "routes": [
            {
              "to": "172.20.1.20/32",
              "via": "172.20.1.20",
              "interface": "eth1"
            },
            {
              "to": "172.20.2.0/24",
              "via": "172.20.1.20",
              "interface": "eth1"
            }
          ]
        },
        "chain-vxlan": {
          "description": "VXLAN decapsulation",
          "dockerfile": "src/containers/vxlan/Dockerfile.vxlan",
          "config_script": "vxlan-config.sh",
          "interfaces": [
            {
              "name": "eth0",
              "network": "ingress-vxlan",
              "ip": {
                "address": "172.20.1.20",
                "mask": 24
              }
            },
            {
              "name": "eth1",
              "network": "vxlan-nat",
              "ip": {
                "address": "172.20.2.10",
                "mask": 24
              }
            }
          ],
          "vxlan_tunnel": {
            "src": "172.20.1.20",
            "dst": "172.20.1.10",
            "vni": 100
          },
          "routes": [
            {
              "to": "10.10.10.0/24",
              "via": "172.20.2.20",
              "interface": "eth1"
            }
          ]
        },
        "chain-nat": {
          "description": "NAT44 translation",
          "dockerfile": "src/containers/Dockerfile.base",
          "config_script": "nat-config.sh",
          "interfaces": [
            {
              "name": "eth0",
              "network": "vxlan-nat",
              "ip": {
                "address": "172.20.2.20",
                "mask": 24
              }
            },
            {
              "name": "eth1",
              "network": "nat-ipsec",
              "ip": {
                "address": "172.20.3.10",
                "mask": 24
              }
            }
          ],
          "nat44": {
            "sessions": 1024,
            "static_mapping": {
              "local_ip": "10.10.10.10",
              "local_port": 2055,
              "external_ip": "172.20.3.10",
              "external_port": 2055
            }
          }
        },
        "chain-ipsec": {
          "description": "IPsec encryption",
          "dockerfile": "src/containers/ipsec/Dockerfile.ipsec",
          "config_script": "ipsec-config.sh",
          "interfaces": [
            {
              "name": "eth0",
              "network": "nat-ipsec",
              "ip": {
                "address": "172.20.3.20",
                "mask": 24
              }
            },
            {
              "name": "eth1",
              "network": "ipsec-fragment",
              "ip": {
                "address": "172.20.4.10",
                "mask": 24
              }
            }
          ],
          "ipsec": {
            "sa_in": {
              "id": 2000,
              "spi": 2000,
              "crypto_alg": "aes-gcm-128",
              "crypto_key": "4a506a794f574265564551694d653768"
            },
            "sa_out": {
              "id": 1000,
              "spi": 1000,
              "crypto_alg": "aes-gcm-128",
              "crypto_key": "4a506a794f574265564551694d653768"
            },
            "tunnel": {
              "src": "172.20.3.20",
              "dst": "172.20.4.20",
              "local_ip": "10.100.100.1/30"
            }
          },
          "routes": [
            {
              "to": "172.20.2.0/24",
              "via": "172.20.3.10"
            },
            {
              "to": "172.20.5.0/24",
              "via": "ipip0"
            },
            {
              "to": "172.20.0.0/24",
              "via": "ipip0"
            }
          ]
        },
        "chain-fragment": {
          "description": "IP fragmentation",
          "dockerfile": "src/containers/fragment/Dockerfile.fragment",
          "config_script": "fragment-config.sh",
          "interfaces": [
            {
              "name": "eth0",
              "network": "ipsec-fragment",
              "ip": {
                "address": "172.20.4.20",
                "mask": 24
              }
            },
            {
              "name": "eth1",
              "network": "fragment-gcp",
              "ip": {
                "address": "172.20.5.10",
                "mask": 24
              },
              "mtu": 1400
            }
          ]
        },
        "chain-gcp": {
          "description": "GCP destination endpoint",
          "dockerfile": "src/containers/Dockerfile.base",
          "config_script": "gcp-config.sh",
          "interfaces": [
            {
              "name": "eth0",
              "network": "fragment-gcp",
              "ip": {
                "address": "172.20.5.20",
                "mask": 24
              }
            }
          ],
          "tap_interface": {
            "id": 0,
            "name": "vpp-tap0",
            "ip": "10.0.3.1/24",
            "linux_ip": "10.0.3.2/24",
            "pcap_file": "/tmp/gcp-received.pcap"
          },
          "routes": [
            {
              "to": "0.0.0.0/0",
              "via": "172.20.5.1"
            },
            {
              "to": "10.0.3.0/24",
              "via": "tap0"
            }
          ]
        }
      },
      "connectivity_tests": [
        {
          "from": "chain-ingress",
          "to": "172.20.1.20",
          "description": "Ingress → VXLAN"
        },
        {
          "from": "chain-vxlan",
          "to": "172.20.2.20",
          "description": "VXLAN → NAT"
        },
        {
          "from": "chain-nat",
          "to": "172.20.3.20",
          "description": "NAT → IPsec"
        },
        {
          "from": "chain-ipsec",
          "to": "172.20.4.20",
          "description": "IPsec → Fragment"
        },
        {
          "from": "chain-fragment",
          "to": "172.20.5.20",
          "description": "Fragment → GCP"
        }
      ],
      "traffic_config": {
        "bridge_ip": "172.20.0.1",
        "vxlan_port": 4789,
        "vxlan_vni": 100,
        "inner_src_ip": "10.10.10.5",
        "inner_dst_ip": "10.10.10.10",
        "inner_dst_port": 2055,
        "packet_count": 10,
        "packet_size": 8000,
        "test_duration": 10
      }
    }
  }
}